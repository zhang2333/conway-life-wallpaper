<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Conway's Game of Life</title>
        <style>
            html, body { 
                width: 100%;
                min-height: 100%;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }

            body {
                background-image: url("./static/background.jpg");
                background-size: 100% 100%;
                background-repeat: no-repeat;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas"></canvas>
        <script src="./src/scripts/conway-life.js"></script>
        <script>
            'use strict';
            // handle events
            (function () {
                var config = {
                    color: 'rgba(255, 255, 255, 0.4)',
                    interval: 1000,
                    initEntropy: 0
                };

                var cf = new ConwayLife('canvas', config).start();
                cf.reBoard = cf.resetBoard();

                cf.on('beforeUpdate', function () {
                    this.cxt.fillStyle = this.config.color;
                    this.draw(this.reBoard);
                });

                cf.on('beforeDraw', function () {
                    for (var i = 0; i < this.reBoard.length; i++) {
                        if (this.reBoard[i]) {
                            this.board[i] = this.reBoard[i];
                        }
                    }
                    this.reBoard = this.resetBoard();
                });

                var dragging = false;
                function handleEvent(e) {
                    var x = Math.round(e.clientX * cf.config.colSize / cf.canvas.width);
                    var y = Math.round(e.clientY * cf.config.rowSize / cf.canvas.height);
                    cf.setCell(cf.reBoard, x, y, 1);
                }

                cf.canvas.onmousedown = function (e) {
                    dragging = true;
                    handleEvent(e);
                }

                cf.canvas.onmouseup = function (e) {
                    dragging = false;
                    handleEvent(e);
                }

                cf.canvas.onmousemove = function (e) {
                    if (!dragging) return;
                    handleEvent(e);
                }

                cf.canvas.onclick = handleEvent;

                document.onkeydown = function (e) {
                    if (e.keyCode === 32) {
                        cf.isPaused = !cf.isPaused;
                    }

                    if (e.keyCode === 13) {
                        cf.isPaused = true;
                        cf.board = cf.resetBoard();
                        cf.reBoard = cf.resetBoard();
                        cf.clear();
                    }
                }

                console.info('interaction:', 'click or press space(pause)/enter(drawing mode)');
            })();
        </script>
    </body>
</html>
